apiVersion: v1
kind: Template
metadata:
  creationTimestamp: null
  name: backup-test
objects:
- apiVersion: v1
  kind: Pod
  metadata:
    name: backup-agent
---
apiVersion: v1 
kind: CronJob
metadata:
  name: backup
spec:
  schedule: "*/5 * * * *"  
  jobTemplate:             
    spec:
      template:
        metadata:
          labels:          
            parent: "cronjobbackup"
        spec:
          containers:
          - env:
            - name: PGPASSWORD
              valueFrom:
                secretKeyRef:
                  name: waiverdb-test-123-secret 
                  key: database-password
          - name: backup
            command: ['pg_dump', '-d', 'waiverdb', '-h', 'waiverdb-test-123-database', '-p', '5432', '-U', 'waiverdb', '>', 'waiverdb-backups/$(date +"%Y-%m-%d-%H:%M:%S,%3N")']
          restartPolicy: OnFailure 
